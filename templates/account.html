{% extends "layout.html" %}
{% block title %}Account - {% endblock %}

{% block main %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<div class="container-fluid">
  <div class="row page-layout-row">
    <section class="col-md-9-custom main-right-panel-wrapper mx-auto" style="min-width: 350px; max-width: 900px;">
      <div class="settings-title-bar">
        <h1 class="settings-page-title">Account</h1>
      </div>
      <!-- Tab Navigation -->
      <div class="settings-tabs d-flex gap-4 mb-4">
        <button class="settings-tab active" data-tab="account">Account Settings</button>
        <button class="settings-tab" data-tab="firm">Firm Settings</button>
      </div>
      <!-- Tab Panels -->
      <div class="settings-tab-panel" id="tab-account">
        <div class="settings-card mb-4">
          <div class="d-flex align-items-center gap-3 mb-4">
            <img src="{{ user_info['avatar_url'] or url_for('static', filename='default-avatar.png') }}" alt="Profile"
              class="profile-pic" style="width: 48px; height: 48px;">
            <div>
              <div class="fw-semibold settings-profile-name">{{ user_info['name'] or 'â€”' }}</div>
              <div class="text-muted settings-profile-username">@{{ user_info['username'] or '' }}</div>
            </div>
          </div>
          <div class="settings-list">
            <!-- Group: Name & Age -->
            <form class="settings-row-bg settings-form-group" id="name-age-form" onsubmit="return false;">
              <div style="flex:1; min-width:180px;">
                <label class="settings-label mb-1">Name</label>
                <input type="text" class="form-control" id="name-input" value="{{ user_info['name'] or '' }}" disabled>
              </div>
              <div style="width:120px;">
                <label class="settings-label mb-1">Age</label>
                <input type="number" class="form-control" id="age-input" value="{{ user_info['age'] or '' }}" disabled>
              </div>
              <div class="settings-form-actions">
                <button type="button" class="btn btn-link p-0 settings-edit-btn" id="edit-name-age">Edit</button>
                <button type="submit" class="btn btn-success d-none" id="save-name-age">Save</button>
                <button type="button" class="btn btn-secondary d-none" id="cancel-name-age">Cancel</button>
              </div>
            </form>
            <!-- Group: Email & Password -->
            <form class="settings-row-bg settings-form-group" id="email-password-form" onsubmit="return false;">
              <div style="flex:2; min-width:220px;">
                <label class="settings-label mb-1">Account Email Address</label>
                <input type="email" class="form-control" id="email-input" value="{{ user_info['email'] or '' }}"
                  disabled>
              </div>
              <div class="settings-form-actions">
                <button type="button" class="btn btn-link p-0 settings-edit-btn" id="edit-email">Change Email</button>
              </div>
            </form>
            <!-- Other fields -->
            <div class="settings-row-bg">
              <div class="settings-row">
                <div class="settings-label">Date of Birth</div>
                <div class="settings-value">Your mentioned Date of birth is: {{ user_info['date'] or '' }}</div>
              </div>
            </div>
            <div class="settings-row-bg">
              <div class="settings-row">
                <div class="settings-label">Account Created</div>
                <div class="settings-value">Your account was created on: {{ user_info['account_created'] or '' }}</div>
              </div>
            </div>
            <div class="settings-row-bg">
              <div class="settings-row">
                <div class="settings-label">Account Verified</div>
                <div class="settings-value">Is your account verified? {{ 'Yes' if user_info['account_verified'] else 'No' }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="settings-tab-panel d-none" id="tab-firm">
        <div class="settings-card mb-4">
          <div class="settings-list">
            <div class="settings-row-bg">
              <div class="settings-row">
                <div class="settings-label">Firm Name</div>
                <div class="settings-value">{{ user_info['firm_name'] or '' }}</div>
                <button class="btn btn-link p-0 settings-edit-btn" data-panel="edit-firm-name">Edit</button>
              </div>
            </div>
            <div class="settings-row-bg">
              <div class="settings-row">
                <div class="settings-label">Firm Join Date</div>
                <div class="settings-value">{{ user_info['firm_join_date'] or '' }}</div>
                <button class="btn btn-link p-0 settings-edit-btn" data-panel="edit-firm-join">Edit</button>
              </div>
            </div>
            <div class="settings-row-bg">
              <div class="settings-row">
                <div class="settings-label">Firm Weekend Days</div>
                <div class="settings-value">{{ user_info['firm_weekend_days'] or '' }}</div>
                <button class="btn btn-link p-0 settings-edit-btn" data-panel="edit-firm-weekend">Edit</button>
              </div>
            </div>
            <div class="settings-row-bg">
              <div class="settings-row">
                <div class="settings-label">Firm Leaves Structure</div>
                <ul class="info-box-value list-unstyled mb-0">
                  {% set granted = user_info['leaves_type'] | from_json %}
                  {% for lt, count in granted.items() %}
                  <li><strong>{{ lt }}</strong>: {{ count }}</li>
                  {% endfor %}
                </ul>
                <button class="btn btn-link p-0 settings-edit-btn" data-panel="edit-leaves">Edit</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
<script>
  // Tab switching
  const tabs = document.querySelectorAll('.settings-tab');
  const panels = document.querySelectorAll('.settings-tab-panel');
  tabs.forEach(tab => {
    tab.addEventListener('click', function () {
      tabs.forEach(t => t.classList.remove('active'));
      panels.forEach(p => p.classList.add('d-none'));
      this.classList.add('active');
      document.getElementById('tab-' + this.dataset.tab).classList.remove('d-none');
    });
  });
  // Inline editing for name/age
  const editNameAgeBtn = document.getElementById('edit-name-age');
  const saveNameAgeBtn = document.getElementById('save-name-age');
  const cancelNameAgeBtn = document.getElementById('cancel-name-age');
  const nameInput = document.getElementById('name-input');
  const ageInput = document.getElementById('age-input');
  editNameAgeBtn.addEventListener('click', function () {
    nameInput.disabled = false;
    ageInput.disabled = false;
    saveNameAgeBtn.classList.remove('d-none');
    cancelNameAgeBtn.classList.remove('d-none');
    editNameAgeBtn.classList.add('d-none');
    nameInput.focus();
  });
  cancelNameAgeBtn.addEventListener('click', function () {
    nameInput.value = '{{ user_info['name'] or '' }}';
    ageInput.value = '{{ user_info['age'] or '' }}';
    nameInput.disabled = true;
    ageInput.disabled = true;
    saveNameAgeBtn.classList.add('d-none');
    cancelNameAgeBtn.classList.add('d-none');
    editNameAgeBtn.classList.remove('d-none');
  });
  // Optionally, handle saveNameAgeBtn click for AJAX save
</script>
{% endblock %}